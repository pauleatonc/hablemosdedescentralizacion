{% extends "base/base.html" %}
{% load static %}

{% block views %}
<section class="container">
  <div class="cols-12 my-5 mx-3">
    <div class="row justify-content-center">
      <div class="col-md-6 mx-md-auto my-2">
        {% include "components/desentralizacion_banner.html" %}
      </div>
      <div class="col-lg-12 d-flex justify-content-between my-2">
        <button type="button" class=" btn btn-pill-primary  text-nowrap"
          onclick="window.location.href='{% url 'surveys_app:pregunta_uno' %}'"><i class="material-symbols-outlined">
            chevron_left
          </i>Ir atrás</button>
        <button type="button" class=" btn btn-pill-primary  text-nowrap"
          onclick="window.location.href='{% url 'surveys_app:pregunta_tres' %}'">Siguiente <i
            class="material-symbols-outlined">
            chevron_right
          </i></button>
      </div>
      <div class="col-12 col-md-12  col-lg-10 my-1">
        <p class="font-level-1  text-center my-3">Pregunta 2 de 5:</p>
        <p class="font-level-4 text-justify mx-2">Te presentamos 4 afirmaciones sobre el impacto de la descentralización
          en las personas y comunidades. </p>

        <lu>
          <p class="font-level-6 text-justify mx-2 font-weight-bold">Ordénalas de mayor a menor importancia considerando
            que:</p>
          <li class=" font-level-5 ml-3 "><strong>1</strong> es la <strong>más </strong>importante</li>
          <li class=" font-level-5 ml-3"><strong>4</strong> es la <strong>menos </strong>importante.</li>
        </lu>
        <div id="frase" class="font-level-4 my-3">Elige cuál enunciado ocupa el lugar:<br><strong class="font-level-2 ml-2 mt-3"> 1 de importancia.</strong></div>
      </div>
      <div class="col-12 col-md-8 col-lg-6 mx-5 my-2 justify-content-center ">
        <form method="post" action="{% url 'surveys_app:pregunta_dos' %}">
          {% csrf_token %}
          <p class="font-level-5 my-1">La descentralizacion:</p>
          <div class="my-2">
            {% if propuesta_1_guardada %}
            {{ form.propuesta_1.help_text }}
            <input type="text" name="propuesta_1" value="{{ propuesta_1_guardada }}" readonly>
            {% else %}
            <button type="button" class="propuesta d-flex flex-row rbg-white border border-primary border-3"
              id="propuesta_1">
              <div class="propuesta-text text-primary m-4 text-justify">{{ form.propuesta_1.help_text }}</div>
              <div class="propuesta-check h1 text-font-weight-bold  mx-3 text-dark align-self-center">-</div>
            </button>
            <input type="hidden" name="propuesta_1">
            {% endif %}
          </div>

          <div class="my-2">
            {% if propuesta_2_guardada %}
            {{ form.propuesta_2.help_text }}
            <input type="text" name="propuesta_2" value="{{ propuesta_2_guardada }}" readonly>
            {% else %}
            <button type="button" class="propuesta  d-flex flex-row rbg-white border border-primary border-3"
              id="propuesta_2">
              <div class="propuesta-text text-primary m-4 text-justify">{{ form.propuesta_2.help_text }}</div>
              <div class="propuesta-check h1 text-font-weight-bold mx-3 text-dark align-self-center">-</div>
            </button>
            <input type="hidden" name="propuesta_2">
            {% endif %}
          </div>

          <div class="my-2">
            {% if propuesta_3_guardada %}
            {{ form.propuesta_3.help_text }}
            <input type="text" name="propuesta_3" value="{{ propuesta_3_guardada }}" readonly>
            {% else %}
            <button type="button" class="propuesta d-flex flex-row rbg-white border border-primary border-3"
              id="propuesta_3">
              <div class="propuesta-text text-primary m-4 text-justify">{{ form.propuesta_3.help_text }}</div>
              <div class="propuesta-check h1 text-font-weight-bold text-dark mx-3 align-self-center">-</div>
            </button>
            <input type="hidden" name="propuesta_3">
            {% endif %}
          </div>

          <div>
            {% if propuesta_4_guardada %}
            {{ form.propuesta_4.help_text }}
            <input type="text" name="propuesta_4" value="{{ propuesta_4_guardada }}" readonly>
            {% else %}
            <button type="button" class="propuesta  d-flex flex-row rbg-white border border-primary border-3"
              id="propuesta_4">
              <div class="propuesta-text text-primary m-4 text-justify">{{ form.propuesta_4.help_text }}</div>
              <div class="propuesta-check h1 font-weight-bold text-dark mx-3 align-self-center">-</div>
            </button>
            <input type="hidden" name="propuesta_4">
            {% endif %}
          </div>

          <!-- Muestra errores del campo valor -->
          {% if form.non_field_errors %}
          <!-- Muestra el mensaje de error específico -->
          <p>{{ form.non_field_errors }}</p>
          {% endif %}

          <div>
            {% if propuesta_1_guardada %}
            <div>Continúa con la siguiente pregunta sobre:</div>
            <div>
              <button type="button" onclick="window.location.href='{% url 'surveys_app:pregunta_tres' %}'">
                Inclusión de iniciativas</button>
            </div>

            {% else %}
            <div>
              <!-- Botón para reiniciar selección -->
              <div class="d-flex mt-4 mb-5">  
              <button type="button" id="reiniciar"  class="btn btn-outline-secondary btn-lg rounded text-decoration-none" style="display: none;">Limpiar ranking <i class="material-symbols-outlined">
                delete
                </i></button>
            </div>
            <p class="font-level-5 text-md-center font-weight-light ">Continúa con la siguiente pregunta sobre:</p>
              <button type="submit" class="btn btn-primary btn-lg btn-block">Inclusión de iniciativas <i class="material-symbols-outlined px-3">
                arrow_forward_ios
              </i></button>
          </div>

            {% endif %}
          </div>

        </form>
      </div>
    </div>
  </div>
</section>
<div class="my-3 col-md-12 mw-100 mx-0"">
  {% include "components/logo_banner.html" %}
</div>

{% endblock views %}

{% block scripts %}

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $(document).ready(function ()
  {
    var prioridad = 1;
    var seleccionados = {};

    $('.propuesta').on('click', function ()
    {
      var propuestaId = $(this).attr('id');

      if (!$(this).prop("disabled"))
      {
        // Marcamos la propuesta como seleccionada
        $(this).prop('disabled', true);

        // Cambiamos el contenido del div de verificación
        $(this).find('.propuesta-check').text(prioridad);

        // Guardamos la prioridad en un objeto
        seleccionados[ propuestaId ] = prioridad;

        // Cambiamos el valor del campo oculto asociado
        $('input[name=' + propuestaId + ']').val(prioridad);

        // Cambiamos el texto de la frase
        prioridad++;
        if (prioridad <= 4)
        {
          $('#frase').html('Elige cuál enunciado ocupa el lugar :<br> <strong  class="font-level-2 ml-2 mt-3">' + prioridad + ' de importancia.</strong> ');
        }

        // Mostramos el botón de reinicio si todas las propuestas tienen una prioridad
        if (Object.keys(seleccionados).length === 4)
        {
          $('#reiniciar').show();
        }
      }
    });

    $('#reiniciar').on('click', function ()
    {
      $('.propuesta').prop('disabled', false);
      $('.propuesta-check').text('-');
      $('input[name=propuesta_1]').val('');
      $('input[name=propuesta_2]').val('');
      $('input[name=propuesta_3]').val('');
      $('input[name=propuesta_4]').val('');
      prioridad = 1;
      seleccionados = {};
      $('#frase').html('Elige cuál enunciado ocupa el lugar :<br> <strong  class="font-level-2 ml-2 mt-3">' + prioridad + ' de importancia.</strong> ');
      $('#reiniciar').hide();
    });

  });
</script>

{% endblock scripts %}