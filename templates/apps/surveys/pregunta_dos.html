{% extends "base/base.html" %}
{% load static %}

{% block views %}
<section class="container">
  <div class="cols-12 my-0 mx-3">
    <div class="row justify-content-center">
      <div class="col-md-6 mx-md-auto my-2">
        {% include "components/desentralizacion_banner.html" %}
      </div>
      <div class="col-lg-9 d-flex justify-content-between my-2">
        <button type="button" class=" btn btn-pill-primary text-primary text-nowrap"
          onclick="window.location.href='{% url 'surveys_app:pregunta_uno' %}'"><i class="material-symbols-outlined">
            chevron_left
          </i>Ir atrás</button>
        {% if propuesta_1_guardada %}
          <button type="button" class=" btn btn-pill-primary text-primary  text-nowrap"
            onclick="window.location.href='{% url 'surveys_app:pregunta_tres' %}'">Siguiente <i
              class="material-symbols-outlined">
              chevron_right
            </i></button>
        {% endif %}
      </div>
      <div class="col-lg-10">
        <p class="font-level-1  text-center my-3">Pregunta 2 de 5:</p>
      </div>

      <div class='col-lg-9 my-2'>
        <p class="font-level-4 text-justify">Pensando en una Política de Descentralización de Chile, ¿qué tan prioritario considera usted cada
          enunciado? Marque su preferencia entre 1 y 4, donde 1 es poco prioritario y 4 es muy prioritario.
        </p>
      </div>

      <div class="col-12 col-md-8 col-lg-9 mx-5 my-2 justify-content-center">
        <form method="POST">
            {% csrf_token %}

            {% for field in form %}
            <div class="card h-50 w-100 border-primary mb-3 text-primary font-level-6 font-weight-light p-3">
              <div class="mb-3">
                {{ field.help_text }}
              </div>
              {{ field }}
              {% if field.errors %}
              <div class="alert text-danger">
                {{ field.errors|striptags }}
              </div>
              {% endif %}
            </div>
          {% endfor %}

          <div class="col-md-6 mx-md-auto mt-4 px-0">
            <p class="font-level-6 font-weight-light">Continúa con la siguiente pregunta sobre:<br><strong class="font-level-6">Tu opinión sobre Descentralización</strong></p>
            <button type="submit"  class="btn btn-primary btn-lg btn-block mb-3" >Siguiente<i class="material-symbols-outlined px-3">
                arrow_forward_ios
            </i></button>
          </div>

        </form>
      </div>

      

      
    </div>
  </div>
</section>
<div class="my-3 col-md-12 mw-100 mx-0 px-0" >
  {% include "components/logo_banner.html" %}
</div>

{% include "components/modal_salida_encuesta.html" %}

{% endblock views %}

{% block scripts %}

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    $(document).ready(function() {
      // Identificar todos los enlaces del navbar y footer
      $('nav a, footer a').on('click', function(e) {
        e.preventDefault();

        // Guardar el href del enlace en el botón de confirmación del modal
        $('#confirmExitButton').attr('href', $(this).attr('href'));

        // Mostrar el modal
        $('#exitSurveyModal').modal('show');
      });
    });
</script>
<script>
  $(document).ready(function ()
  {
    var prioridad = 1;
    var seleccionados = {};

    $('.propuesta').on('click', function ()
    {
      var propuestaId = $(this).attr('id');

      if (!$(this).prop("disabled"))
      {
        // Marcamos la propuesta como seleccionada
        $(this).prop('disabled', true);

        // Cambiamos el contenido del div de verificación
        $(this).find('.propuesta-check').text(prioridad);

        // Guardamos la prioridad en un objeto
        seleccionados[ propuestaId ] = prioridad;

        // Cambiamos el valor del campo oculto asociado
        $('input[name=' + propuestaId + ']').val(prioridad);

        prioridad++;

        // Cambiamos el texto de la frase
        if (prioridad <= 4)
        {
          $('#frase').html('Elige cuál enunciado ocupa el lugar :<br> <strong  class="font-level-2 mt-3 text-primary ">' + prioridad + ' de importancia.</strong> ');
          $('#next-button').prop('disabled', true);
        }

        // Mostramos el botón de reinicio si todas las propuestas tienen una prioridad
        if (Object.keys(seleccionados).length === 1)
        {
          $('#reiniciar').show();
          $('#frase-button').show();
        }
      }
      // Comprobar si todas las propuestas están seleccionadas
        if(Object.keys(seleccionados).length === 4)
      {
          // Habilitar el botón 'Siguiente'
          $('#next-button').prop('disabled', false);
      }
      });

    $('#reiniciar').on('click', function ()
    {
      $('.propuesta').prop('disabled', false);
      $('.propuesta-check').text('-');
      $('input[name=propuesta_1]').val('');
      $('input[name=propuesta_2]').val('');
      $('input[name=propuesta_3]').val('');
      $('input[name=propuesta_4]').val('');
      prioridad = 1;
      seleccionados = {};
      $('#frase').html('Elige cuál enunciado ocupa el lugar :<br> <strong  class="font-level-2 text-primary mt-3 ">' + prioridad + ' de importancia.</strong> ');
      $('#reiniciar').hide();
      $('#frase-button').hide();

      // Deshabilitar el botón 'Siguiente'
      $('#next-button').prop('disabled', true);
    });

    // Función para establecer el estado inicial
  function setInitialState(id, prioridad) {
    // Si el valor es no nulo, establecemos la prioridad y desactivamos el botón
    if (prioridad) {
      $('#' + id).prop('disabled', true);
      $('#' + id).find('.propuesta-check').text(prioridad);
      seleccionados[id] = prioridad;
      prioridad++;
      if (prioridad <= 4) {
        $('#frase').html('Elige cuál enunciado ocupa el lugar :<br> <strong  class="font-level-2  mt-3 text-primary ">' + prioridad + ' de importancia.</strong> ');
      }
      if (Object.keys(seleccionados).length === 1) {
        $('#reiniciar').show();
        $('#frase-button').show();
      }
    }
  }

  // Llamamos a esta función para cada propuesta
  setInitialState('propuesta_1', $('#valor_propuesta_1').val());
  setInitialState('propuesta_2', $('#valor_propuesta_2').val());
  setInitialState('propuesta_3', $('#valor_propuesta_3').val());
  setInitialState('propuesta_4', $('#valor_propuesta_4').val());

  // Deshabilitar el botón 'Siguiente'
      $('#next-button').prop('disabled', false);
 });
</script>

{% endblock scripts %}
